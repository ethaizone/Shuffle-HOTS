<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Shuffle HOTS</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.js"></script>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css" >
    
  

<script type="text/javascript">
  /**
 * js-weighted-list.js
 * 
 * version 0.2
 * 
 * This file is licensed under the MIT License, please see MIT-LICENSE.txt for details.
 * 
 * https://github.com/timgilbert/js-weighted-list is its home.
 */
var WeightedList=function(){function t(t){if(this.weights={},this.data={},this.length=0,this.hasData=!1,t="undefined"!=typeof t?t:[],!Array.isArray(t))throw new Error('Unknown object "'+t.toString()+'" passed to WeightedList constructor! (Expected array or nothing)');for(var e=0;e<t.length;e++)this.push(t[e])}function e(t,e,h){this.weight=t,this.value=e,this.total=h}function h(t){this.heap=[null];for(var h=0;h<t.length;h++){var i=t[h][1],r=t[h][0];this.heap.push(new e(i,r,i))}for(h=this.heap.length-1;h>1;h--)this.heap[h>>1].total+=this.heap[h].total}return t.prototype={push:function(t){var e,h,i;if(Array.isArray(t)){if(e=t[0],h=t[1],i=t[2],"undefined"==typeof e)throw new Error("In WeightedList.push([ ... ]), need at least two elements");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push([ ... ]), second element is undefined!")}else{if("object"!=typeof t)throw new Error('WeightedList.push() passed unknown type "'+typeof t+'", expected [key, weight] or {"key": k, "weight": w}');if(e=t.key,h=t.weight,i=t.data,"undefined"==typeof e)throw new Error("In WeightedList.push({ ... }), no {'key': 'xyzzy'} pair found");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push({ ... }), no {'weight': 42} pair found")}return this._push_values(e,h,i)},_push_values:function(t,e,h){if(this.weights[t])throw new Error("");if("number"!=typeof e)throw new Error("Weight must be numeric (got "+e.toString()+")");if(0>=e)throw new Error("Weight must be >= 0 (got "+e+")");this.weights[t]=e,"undefined"!=typeof h&&(this.hasData=!0,this.data[t]=h),this.length++},addWeight:function(t,e){this.weights[t]+=e},peek:function(t,e){if("undefined"==typeof t&&(t=1),e=!!e,this.length-t<0)throw new Error("Stack underflow! Tried to retrieve "+t+" element"+(1===t?"":"s")+" from a list of "+this.length);for(var h=this._buildWeightedHeap(),i=[],r=0;t>r;r++){var n=h.pop();this.hasData?i.push({key:n,data:this.data[n]}):i.push(n),e&&(delete this.weights[n],delete this.data[n],this.length--)}return i},shuffle:function(){return this.peek(this.length)},pop:function(t){return this.peek(t,!0)},_buildWeightedHeap:function(){var t=[];for(var e in this.weights)this.weights.hasOwnProperty(e)&&t.push([e,this.weights[e]]);return new h(t)}},h.prototype={pop:function(){for(var t=this.heap[1].total*Math.random(),e=1;t>this.heap[e].weight;)t-=this.heap[e].weight,e<<=1,t>this.heap[e].total&&(t-=this.heap[e].total,e++);var h=this.heap[e].value,i=this.heap[e].weight;for(this.heap[e].weight=0;e>0;)this.heap[e].total-=i,e>>=1;return h}},t}();
</script>



<script type="text/javascript">//<![CDATA[

Array.prototype.remove=function(){for(var t,r,e=arguments,i=e.length;i&&this.length;)for(t=e[--i];-1!==(r=this.indexOf(t));)this.splice(r,1);return this};

//https://github.com/coolaj86/knuth-shuffle
function shuffle(r){for(var f,n,o=r.length;0!==o;)n=Math.floor(Math.random()*o),o-=1,f=r[o],r[o]=r[n],r[n]=f;return r}

var swapArrayElements = function(arr, indexA, indexB) {
  var temp = arr[indexA];
  arr[indexA] = arr[indexB];
  arr[indexB] = temp;
};

$(window).load(function(){

  var original_players = [
      'EThaiZone',
      'iGolf',
      'Thunderbird',
      'HeavyMod',
      'Plugin87',
      'NodeJS',
      'Kousuke',
      'Krucamper',
      'InwJack',
      'Alligator'
  ];

  var maps = [
    ['Battlefield of Eternity', 1, {bg_class: 'map-battlefield-of-eternity'}],
    // ['Blackheart\'s Bay', 1, {bg_class: 'map-blackheart-bay'}],
    ['Cursed Hollow', 2, {bg_class: 'map-cursed-hollow'}],
    ['Dragon Shire', 3, {bg_class: 'map-dragon-shire'}],
    ['Garden of Terror', 2, {bg_class: 'map-garden-of-terror'}],
    ['Haunted Mines', 2, {bg_class: 'map-haunted-mine'}],
    // ['Infernal Shrines', 1, {bg_class: 'map-infernal-shrines'}],
    ['Sky Temple', 2, {bg_class: 'map-sky-temple'}],
    ['Tomb of the Spider Queen', 2, {bg_class: 'map-tomb-of-the-spider-queen'}],
    ['Towers of Doom', 8, {bg_class: 'map-tower-of-doom'}]
  ];
  var lastClassMapBG;

  var players = [];

  var bot = "-- AI Elite --";


  function resetPlayer() {
    $("#map").text("Welcome to the Nexus");
    players = original_players.slice();
    renderPlayers();
  }

  function renderPlayers(luckyPlayer) {
    $("#players").empty();
    $.each(players, function( index, value ) {
      var item = $('<li class="list-group-item player"/>').text(value);
      if (value == luckyPlayer)
      {
        var $star = $('<span class="glyphicon glyphicon-star" aria-hidden="true" style="margin-left: 5px; color:orange; text-shadow:none;"></span>');
        
        item.append($star);
        item.attr('title', 'You are lucky player!');
      }
      // alert( index + ": " + value );
      $("#players").append(item);
    });
  }

  function teamHighlight() {
      var team_lottery = [0, 1];
    shuffle(team_lottery);

    $(".player").each(function( index, item ) {
      var $item = $(item);
      if (index < (players.length/2)) {
        if (team_lottery[0] == 1) {
          $item.addClass("team_red");
        } else {
          $item.addClass("team_blue");
        }
      } else {
        if (team_lottery[0] == 1) {
          $item.addClass("team_blue");
        } else {
          $item.addClass("team_red");
        }

      }
      
    });
  }

  function randomMap() {
    var mapList = new WeightedList(maps);
    var picked = mapList.peek();
    console.log(picked);
    $("#map").text(picked[0].key);
    if (lastClassMapBG)
    {
      $("#map_background").removeClass(lastClassMapBG);
    }
    lastClassMapBG = picked[0].data.bg_class;
    $("#map_background").addClass(lastClassMapBG);
  }

  resetPlayer();

  $("#players").on('click', '.player', function() { 
    var $this = $(this);
    var player = $this.text();
    if (confirm("วันนี้ '"+player+"' ไม่มาสินะ?")){
      players.remove(player);
      if (player == bot) {
        $('#swap_to_bot').attr('disabled', true);
      }
      renderPlayers();
    } 
  });

  $("#random_map").on('click', function(){
    randomMap();
  });

  $("#reset").on('click', function(){
    resetPlayer();
    $('#swap_to_bot').attr('disabled', true);
  });

  $("#shuffle").on('click',function(){
    if (players.length%2 != 0) {
      var hasBot = false;
      $.each(players, function( index, player ) {
        if (player == bot) {
          players.remove(player);
          hasBot = true;
        }
      });

      if (hasBot == false) {
        var notice = "พวกเรามีคนเล่นทั้งหมดจำนวน "
            +players.length
            +" คน\n"
            +"ถ้าสุ่มแล้วจะมีบอทแถมมาด้วยนะ จะสุ่มต่อไหม?";
        if(! confirm(notice)) {
          alert("เอาใครสักคนออกให้ลงเลขคู่เถอะ");
          return;
        }
      }
    }
    shuffle(players);
    if (players.length%2 != 0) {
      players.push(bot);
      $('#swap_to_bot').attr('disabled', false);
    }
    renderPlayers();

    teamHighlight();
    randomMap();

  });

  $("#swap_to_bot").on('click', function(e){
    // check bot number bot must have 1 so I will alert error
    var botTotal = 0;
    $.each(players, function( index, value ) {
      if (value == bot) {
        botTotal++;
      }
    });
    if (botTotal > 1) {
      alert("มีบอทมากกว่า 1 ตัว ไม่สามารถสลับทีมได้ กรุณาเอาบอทออกให้เหลือ 1 ด้วย");
      return false;
    }

    if (botTotal < 1) {
      // players.push(bot);
      // shuffle(players);
      // renderPlayers();
      alert("ต้องมีบอท 1 ตัว ไม่สามารถสลับทีมได้");
      return false;
    }

    if (players.length%2 != 0) {
      alert("สมาชิกทีมไม่เท่ากัน ไม่สามารถสลับทีมได้");
      return false;
    }

    // find which team that bot is in.
    var botTeam;
    $.each(players, function( index, value ) {
      if (value == bot) {
        if (players.length/2 > index)
        {
          botTeam = 'A';
        }
        else
        {
          botTeam = 'B';
        }
      }
    });
    // get team member that don't be with bot and remove 1 member out for act as host same as bot
    var lucky;
    var currentMember = [];
    $.each(players, function( index, value ) {
      currentMember.push(value);
    });
    var migrate;
    if (botTeam == 'A')
    {
      migrate = currentMember.splice(currentMember.length/2, currentMember.length/2);
    }
    else
    {
      migrate = currentMember.splice(0, currentMember.length/2);
    }
    shuffle(migrate);
    hostHuman = migrate.splice(0, 1);

    // swap member of two team
    $.each(migrate, function( order, value ) {
      var foundMigrate;
      $.each(players, function(i, v ) {
        if (v == value) {
          foundMigrate = i;
        }
      });
      var foundReplacement;
      $.each(players, function(i, v ) {
        var start;
        if (botTeam == 'A')
        {
          start = 0;
        }
        else
        {
          start = players.length/2;
        }
        // console.log('start', start, botTeam);
        if (i < start)
        {
          return;
        }

        if (v == bot) {
          order = order+1;
          return;
        }
        if ((i-start) == order) {
          foundReplacement = i;
          return;
        }
      });
      console.log(foundMigrate, foundReplacement);
      swapArrayElements(players, foundMigrate, foundReplacement);
    });
    renderPlayers(hostHuman[0]);
    teamHighlight();
    randomMap();
    // console.log(migrate);
  });
  setTimeout(function(){
    var preloader = $("#preloader");
    $.each(maps, function(i, v) {
      var div = $("<div class='map-bg "+v[2].bg_class+"'></div>");
      preloader.append(div);
    });
    preloader.show();
  }, 300);

});//]]> 

</script>

</head>
<body>
<h1 class="header">Heroes of the Storm</h1>
<div class="container-fluid map-bg" id="map_background">
	<div class="row">
		<div class="col-sm-6 col-sm-offset-3 inner-container">
			<div class="mapping noselect pointer">
				<h1 id="map"></h1>
			</div>
			<div class="player-list">
				<ul class="list-group" id="players">
				</ul>
				<button id="shuffle" class="btn btn-primary btn-block btn-lg">สุ่มแล้วจัดทีม!</button>
				<button id="swap_to_bot" class="btn btn-default btn-block" disabled>สลับอีกทีมมาเล่นกับบอท!</button>
				<p class="help-block text-center">คลิกบนชื่อเพื่อเอาออกจากรายการสำหรับคนที่ไม่เล่นวันนี้</p>
			</div>
			<div class="row">
				<div class="col-sm-6">
					<button id="reset" class="btn btn-default btn-block">รีเซ็ตรายการผู้เล่น!</button>
				</div>
				<div class="col-sm-6">
					<button id="random_map" class="btn btn-default btn-block">Random Battleground</button>
				</div>
			</div>
		</div> <!-- /.col-sm-8 -->
	</div> <!-- /.row -->
	<footer class="text-center">
		<p>Fork at <a href="https://github.com/ethaizone/Shuffle-HOTS">Github</a>.</p>
	</footer>
</div>

<!-- preload -->
<div style="width:1px;height: 1px;overflow: hidden;opacity: 0; display:none;" id="preloader">
  <span class="glyphicon glyphicon-star"></span>
</div>



</body></html>