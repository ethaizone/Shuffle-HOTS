<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Shuffle HOTS</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.js"></script>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    
  
  <style type="text/css">
.container-fluid {
  padding: 20px 30px 20px 30px;
}
.player:hover {
  background-color: rgba(0,0,0, 0.10);
}

.player:hover:after {
  content: 'x';
  float: right;
}
.team_red {
  background-color: rgba(255, 0, 0, 0.28);
}
.team_blue {
  background-color: rgba(0, 0, 255, 0.28);
}
.mapping {
  background-color: #44568b; 
  font-size: 20px;
  color: #fff;
  padding: 10px;
  margin-bottom: 10px;
}
.mapping > p {
  margin: 0px;
}
</style>

<script type="text/javascript">
  /**
 * js-weighted-list.js
 * 
 * version 0.2
 * 
 * This file is licensed under the MIT License, please see MIT-LICENSE.txt for details.
 * 
 * https://github.com/timgilbert/js-weighted-list is its home.
 */
var WeightedList=function(){function t(t){if(this.weights={},this.data={},this.length=0,this.hasData=!1,t="undefined"!=typeof t?t:[],!Array.isArray(t))throw new Error('Unknown object "'+t.toString()+'" passed to WeightedList constructor! (Expected array or nothing)');for(var e=0;e<t.length;e++)this.push(t[e])}function e(t,e,h){this.weight=t,this.value=e,this.total=h}function h(t){this.heap=[null];for(var h=0;h<t.length;h++){var i=t[h][1],r=t[h][0];this.heap.push(new e(i,r,i))}for(h=this.heap.length-1;h>1;h--)this.heap[h>>1].total+=this.heap[h].total}return t.prototype={push:function(t){var e,h,i;if(Array.isArray(t)){if(e=t[0],h=t[1],i=t[2],"undefined"==typeof e)throw new Error("In WeightedList.push([ ... ]), need at least two elements");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push([ ... ]), second element is undefined!")}else{if("object"!=typeof t)throw new Error('WeightedList.push() passed unknown type "'+typeof t+'", expected [key, weight] or {"key": k, "weight": w}');if(e=t.key,h=t.weight,i=t.data,"undefined"==typeof e)throw new Error("In WeightedList.push({ ... }), no {'key': 'xyzzy'} pair found");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push({ ... }), no {'weight': 42} pair found")}return this._push_values(e,h,i)},_push_values:function(t,e,h){if(this.weights[t])throw new Error("");if("number"!=typeof e)throw new Error("Weight must be numeric (got "+e.toString()+")");if(0>=e)throw new Error("Weight must be >= 0 (got "+e+")");this.weights[t]=e,"undefined"!=typeof h&&(this.hasData=!0,this.data[t]=h),this.length++},addWeight:function(t,e){this.weights[t]+=e},peek:function(t,e){if("undefined"==typeof t&&(t=1),e=!!e,this.length-t<0)throw new Error("Stack underflow! Tried to retrieve "+t+" element"+(1===t?"":"s")+" from a list of "+this.length);for(var h=this._buildWeightedHeap(),i=[],r=0;t>r;r++){var n=h.pop();this.hasData?i.push({key:n,data:this.data[n]}):i.push(n),e&&(delete this.weights[n],delete this.data[n],this.length--)}return i},shuffle:function(){return this.peek(this.length)},pop:function(t){return this.peek(t,!0)},_buildWeightedHeap:function(){var t=[];for(var e in this.weights)this.weights.hasOwnProperty(e)&&t.push([e,this.weights[e]]);return new h(t)}},h.prototype={pop:function(){for(var t=this.heap[1].total*Math.random(),e=1;t>this.heap[e].weight;)t-=this.heap[e].weight,e<<=1,t>this.heap[e].total&&(t-=this.heap[e].total,e++);var h=this.heap[e].value,i=this.heap[e].weight;for(this.heap[e].weight=0;e>0;)this.heap[e].total-=i,e>>=1;return h}},t}();
</script>



<script type="text/javascript">//<![CDATA[

Array.prototype.remove=function(){for(var t,r,e=arguments,i=e.length;i&&this.length;)for(t=e[--i];-1!==(r=this.indexOf(t));)this.splice(r,1);return this};

$(window).load(function(){

  var original_players = [
      'EThaiZone',
      'iGolf',
      'Thunderbird',
      'HeavyMod',
      'Plugin87',
      'NodeJS',
      'Kousuke',
      'Krucamper',
      'InwJack',
      'Alligator'
  ];

  var maps = [
    ['Battlefield of Eternity', 1],
    // ['Blackheart\'s Bay', 1],
    ['Cursed Hollow', 1],
    ['Dragon Shire', 2],
    ['Garden of Terror', 1],
    ['Haunted Mines', 1],
    // ['Infernal Shrines', 1],
    ['Sky Temple', 1],
    ['Tomb of the Spider Queen', 1],
    ['Towers of Doom', 8]
  ];

  var players = [];

  //https://github.com/coolaj86/knuth-shuffle
  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex ;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }

  function resetPlayer() {
    $("#map").text("กดสุ่มสิ");
    players = original_players.slice();
    renderPlayers();
  }

  function renderPlayers() {
    $("#players").empty();
    $.each(players, function( index, value ) {
      var item = $('<li class="list-group-item player"/>').text(value);
      // alert( index + ": " + value );
      $("#players").append(item);
    });
  }

  resetPlayer();

  $("#players").on('click', '.player', function() { 
    var $this = $(this);
    var player = $this.text();
    if (confirm("วันนี้ '"+player+"' ไม่มาสินะ?")){
      players.remove(player);
      renderPlayers();
    } 
  });

  $("#reset").on('click', function(){
    resetPlayer();
  });

  $("#shuffle").on('click',function(){
    if (players.length%2 != 0) {
      var notice = "พวกเรามีคนเล่นทั้งหมดจำนวน "
          +players.length
          +" คน\n"
          +"ถ้าสุ่มแล้วจะมีบอทแถมมาด้วยนะ จะสุ่มต่อไหม?";
      if(! confirm(notice)) {
        alert("เอาใครสักคนออกให้ลงเลขคู่เถอะ");
        return;
      }
    }
    shuffle(players);
    if (players.length%2 != 0) {
      players.push("## Elite BOT ##");
    }
    renderPlayers();


    var team_lottery = [0, 1];
    shuffle(team_lottery);

    $(".player").each(function( index, item ) {
      var $item = $(item);
      if (index < (players.length/2)) {
        if (team_lottery[0] == 1) {
          $item.addClass("team_red");
        } else {
          $item.addClass("team_blue");
        }
      } else {
        if (team_lottery[0] == 1) {
          $item.addClass("team_blue");
        } else {
          $item.addClass("team_red");
        }

      }
      
    });

    var mapList = new WeightedList(maps);
    $("#map").text(mapList.peek()[0]);

  });


});//]]> 

</script>

</head>
<body>
<div class="container-fluid">
  <div class="row">
    <p>คลิ๊กบนชื่อเพื่อเอาออกจากรายการสำหรับคนที่ไม่เล่นวันนี้</p>
    <ul class="list-group" id="players">
    </ul>

   <div class="well mapping">
      <p>แผนที่: <span id="map"></span></p>
   </div>

    <p>
      <button id="shuffle" class="btn">สุ่มแล้วจัดทีม!</button> 
      <button id="reset" class="btn">รีเซ็ตรายการผู้เล่น!</button>
    </p>
  </div>
  <div class="row">
    <p>Fork at <a href="https://github.com/ethaizone/Shuffle-HOTS">Github</a>.</p>

  </div>
</div>

  



</body></html>